<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Petter's site - Emacs, gdb and pretty printing</title>
    <link rel="stylesheet" type="text/css" href="/style.css" media="screen">
    <meta name="generator" content="nanoc 3.1.7">
  </head>
  <body>
    <div id="top">
      <ul>
	<!-- Sort all items by date -->
	<!-- Calculate topbar menu items -->
	
	
	  
        
	  
            
	  
        
	  
        
	  
            
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
            
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	  
            
	  
        
	  
        
	  
        
	  
        
	  
        
	  
        
	
	  <!-- &#124 <hspace=10> <a href="/programming/index.html">programming</a> -->
	  
	    <li><a href="/programming/index.html" title="" class="active">programming</a></li>
	  
        
	  <!-- &#124 <hspace=10> <a href="/home/index.html">home</a> -->
	  
	    <li><a href="/home/index.html" title="">home</a></li>
	  
        
	  <!-- &#124 <hspace=10> <a href="/blog/index.html">blog</a> -->
	  
	    <li><a href="/blog/index.html" title="">blog</a></li>
	  
        
	  <!-- &#124 <hspace=10> <a href="/education/index.html">education</a> -->
	  
	    <li><a href="/education/index.html" title="">education</a></li>
	  
        
      </ul>
    </div>
    
    <div id="sidebar">
      <h2>Contents</h2>
      <ul>
      
          <li><a href="/programming/emacs-email/">How to read email in emacs</a></li>
      
          <li><a href="/programming/emacs/">Emacs, gdb and pretty printing</a></li>
      
          <li><a href="/programming/">Programming</a></li>
      
      </ul>
      <h2>Credits</h2>
      <ul>
        <li><a href="http://www.scientificlinux.org">Scientific Linux</a></li>
        <li><a href="http://nanoc.stoneship.org">nanoc web publishing system</a></li>
      </ul>
    </div>
    <div id="main">
      <p>Tags: <a class="tag" href="/tags/emacs/">emacs</a> <a class="tag" href="/tags/programming/">programming</a> </p>
      <h1 id="emacs-gdb-and-pretty-printing">Emacs, gdb and pretty printing</h1>

<p>I&rsquo;ve recently discovered that there truly exists one IDE to rule them all. And sorry Vi fans, it is emacs. </p>

<h2 id="the-editor">The editor</h2>

<p>The emacs editor is based on the idea that you can accomplish anything with the keyboard. While I do find that most IDE actually <em>support</em> the use of the keyboard through shortcuts, emacs actually <em>forces</em> you to learn the shortcuts and thus making you (at least me) a more efficient code editor.</p>

<p>It also handles identation very gracefully. Entering a tab character from <em>anywhere on the line</em> idents the whole line to the appropriate place. I&rsquo;ve never seen any other editor do that, and while coding I&rsquo;ve never missed the opportunity to insert a tab character somewhere in the line.</p>

<p>I&rsquo;ve yet to discover a coding style that emacs does not recognize out of the box, so I&rsquo;ve never fussed with setting up syntax highlighting or identation. Emacs can also interact with a lot of language interpreters as well. That means I can launch e.g. Python from within emacs and runs chunks of code or the entire file I am editing. </p>

<p>I can warmly recommend reading <a href="http://deep.syminet.com/emacside.html">Emacs as you IDE</a>, which basically contains all you need to get started. It also gives you an idea about just how flexible and extensible emacs is.</p>

<h2 id="debugging">Debugging</h2>

<p>Disclaimer: I&rsquo;ve mainly worked with C++ but I believe the following experience translate to a lot of programming languages. </p>

<p>Emacs has the slightly pompously named Grand Unified Debugger, which basically is an interface between many command line debuggers and the emacs editor. What it means to me is that I can launch gdb from within emacs and leverage the power of command line gdb while following the code in the editor.</p>

<p>It is in fact also very easy to use. To invoke gdb:</p>

<div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>M-x gdb</pre></div>
</div>

<p>This asks you how to run gdb. By default the annotate=3 is given, which I believe is necessary for the interaction with emacs. After that, simply enter the path of the binary you have compiled from your code, press enter and watch emacs purr. This gives you a split screen window with gdb on one side and some code on the other side. Gdb commands must be entered in the gdb window, and that can only be interacted with while the code is not running. Make sure to hit C-c C-c to interrupt the code execution to enable gdb interaction (set breakpoints etc.).</p>

<p>The following commands should suffice to be able to mimic most modern IDEs, listed in the order you&rsquo;re likely to need it.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Command</th>
      <th style="text-align: left">Result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">r</td>
      <td style="text-align: left">Run program</td>
    </tr>
    <tr>
      <td style="text-align: left">C-c C-c</td>
      <td style="text-align: left">Halt program execution</td>
    </tr>
    <tr>
      <td style="text-align: left">C-x SPACE</td>
      <td style="text-align: left">Insert breakpoint (from source buffer, program execution must be halted)</td>
    </tr>
    <tr>
      <td style="text-align: left">delete <em>n</em></td>
      <td style="text-align: left">Delete breakpoint number <em>n</em></td>
    </tr>
    <tr>
      <td style="text-align: left">delete</td>
      <td style="text-align: left">Delete all breakpoints</td>
    </tr>
    <tr>
      <td style="text-align: left">n</td>
      <td style="text-align: left">Next line</td>
    </tr>
    <tr>
      <td style="text-align: left">s</td>
      <td style="text-align: left">Step into</td>
    </tr>
    <tr>
      <td style="text-align: left">f</td>
      <td style="text-align: left">Finish current function</td>
    </tr>
    <tr>
      <td style="text-align: left">c</td>
      <td style="text-align: left">Continue until next breakpoint</td>
    </tr>
    <tr>
      <td style="text-align: left">p</td>
      <td style="text-align: left">Print variable</td>
    </tr>
    <tr>
      <td style="text-align: left">bt</td>
      <td style="text-align: left">Print current stack backtrace</td>
    </tr>
    <tr>
      <td style="text-align: left">set args <em>args</em></td>
      <td style="text-align: left">Pass <em>args</em> as arguments to the command</td>
    </tr>
    <tr>
      <td style="text-align: left">set args</td>
      <td style="text-align: left">Clear arguments</td>
    </tr>
    <tr>
      <td style="text-align: left">condition <em>n</em> <em>cond</em></td>
      <td style="text-align: left">Set a condition to breakpoint <em>n</em>, e.g. i==4 or name==&rdquo;Petter&rdquo;</td>
    </tr>
    <tr>
      <td style="text-align: left">condition <em>n</em></td>
      <td style="text-align: left">Remove condition on breakpoint <em>n</em></td>
    </tr>
  </tbody>
</table>

<h2 id="pretty-printing">Pretty printing</h2>
<p>Thus far, we&rsquo;ve only covered normal gdb printing, and for C++ this is not very useful. For example, trying to print a string will give you the <em>memory address</em> of that string. So we really need to crank up it&rsquo;s usefulness.</p>

<p>Such a shortcoming really puts gdb far behind the competition, but fortunately enough people use gdb that this has been fixed. Download <a href="http://quickgit.kde.org/?p=kdevelop.git&amp;a=blob_plain&amp;h=43e7be3023451410cd984de96a5c0e6445648cf4&amp;hb=1d0811b4cfa15a19f1bfce983a16519a8f577fb5&amp;f=debuggers/gdb/printers/qt4.py">this script</a> and save it in a suitable location. In you home directory, put the following in .gdbinit</p>

<div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>python
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>import sys
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>sys.path.insert(0, '/suitable/location')
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>from qt4 import register_qt4_printers
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>register_qt4_printers (None)
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>end
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>set print pretty 1</pre></div>
</div>

<p>I was truly impressed with that scripts, because it would even print some custom datatypes that we have in the codebase we use at work. </p>

<h2 id="using-gud">Using GUD</h2>
<p>The Grand Unified Debugger has some useful tools too. Truth to be told, I&rsquo;ve only used the stack window which helps me move up the callstack to see how my program got to the state it is in right now. Just open the GUD menu in emacs and see what it can do for you!</p>

<h2 id="slow-stepping">Slow stepping?</h2>

<p>I don&rsquo;t know how prevalent this bug is, but should you experience extremely slow function stepping in gdb, setting the following environment variable might help you:</p>

<div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>LD_BIND_NOW=1</pre></div>
</div>

      <p align="right"><i>Posted 15 May 2012</i></p>
      

      <div id="disqus_thread"></div>
      <script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'petterssite';
	var disqus_identifier = 'Emacs, gdb and pretty printing'; 
	
	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

      
    
      </div>
    </div>
  </body>
</html>
